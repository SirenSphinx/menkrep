# Nama workflow Anda, akan muncul di tab "Actions"
name: Compile MultiMC for Windows

# Pemicu: Kapan workflow ini harus dijalankan?
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      # 1. Mengunduh kode sumber
      - name: Checkout Code + Submodules
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'

      # 2. Menginstal Java JDK 8
      - name: Setup Java JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '8'

      # 3. Menyiapkan MSYS2
      - name: Setup MSYS2
        uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW32
          update: true

      # 4. Memperbarui database Pacman dan Menginstal Dependensi
      - name: Update Pacman and Install Dependencies
        shell: msys2 {0}
        run: |
          # Perbarui database paket terlebih dahulu
          pacman -Syuu --noconfirm
          
          # Instal semua dependensi yang dibutuhkan
          pacman -S --noconfirm --needed \
            mingw-w64-i686-cmake \
            mingw-w64-i686-toolchain \
            mingw-w64-i686-zlib \
            mingw-w64-i686-openssl \
            mingw-w64-i686-qt5-base \
            mingw-w64-i686-qt5-svg \
            mingw-w64-i686-qt5-xml

      # 5. Konfigurasi, Build, dan Install
      - name: Configure, Build, and Install
        shell: msys2 {0}
        run: |
          cmake -S . -B build -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release
          cmake --build build --config Release -- -j2
          cmake --install build --prefix ./dist

      # 6. Mengunggah hasil akhir sebagai "Artifact"
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: MultiMC-Windows-Build
          path: ./dist/
