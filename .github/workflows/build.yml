# Nama workflow Anda, akan muncul di tab "Actions"
name: Compile MultiMC for Windows

# Pemicu: Kapan workflow ini harus dijalankan?
on:
  # Saat ada 'push' ke branch 'main'
  push:
    branches: [ "main" ]
  # Agar bisa dijalankan secara manual dari tab Actions
  workflow_dispatch:

# Daftar "pekerjaan" yang harus dilakukan
jobs:
  # Kita definisikan satu pekerjaan bernama "build-windows"
  build-windows:
    # Pekerjaan ini akan berjalan di mesin virtual Windows versi terbaru
    runs-on: windows-latest

    # Ini adalah langkah-langkah yang akan dieksekusi secara berurutan
    steps:
      # 1. Mengunduh kode sumber Anda (termasuk submodul) ke mesin virtual
      - name: Checkout Code + Submodules
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'

      # 2. Menginstal Java JDK 8, yang dibutuhkan oleh MultiMC
      - name: Setup Java JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '8'

      # 3. Menginstal Qt (framework utama)
      - name: Install Qt
        uses: jurplel/install-qt-action@v3
        with:
          version: '5.15.2'
          arch: 'win32_mingw81'

      # 4. Menyiapkan MSYS2 dan menginstal semua dependensi dari sana
      - name: Setup MSYS2 and Dependencies
        uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW32 # Menentukan lingkungan MinGW 32-bit
          update: true
          install: >- # Daftar paket yang akan diinstal melalui 'pacman'
            mingw-w64-i686-cmake
            mingw-w64-i686-toolchain
            mingw-w64-i686-zlib
            mingw-w64-i686-openssl

      # 5. Konfigurasi, Build, dan Install (semua dalam shell MSYS2)
      - name: Configure, Build, and Install
        shell: msys2 {0}
        run: |
          # Konfigurasi proyek menggunakan CMake.
          # Kita hapus CMAKE_PREFIX_PATH agar CMake bisa menemukan Qt secara otomatis.
          cmake -S . -B build -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release
          
          # Meng-compile proyek
          cmake --build build --config Release -- -j2
          
          # Menginstal aplikasi ke folder 'dist'
          cmake --install build --prefix ./dist

      # 6. Mengunggah hasil akhir sebagai "Artifact"
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: MultiMC-Windows-Build
          path: ./dist/
